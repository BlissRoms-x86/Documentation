<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.5.0.766768982351">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.5.0">

    <!-- Primary Meta Tags -->
    <title>Advanced configuration for qemu</title>
    <meta name="title" content="Advanced configuration for qemu">
    <meta name="description" content="Qemu is a very powerful tool that may be confusing for a lot of people.">

    <!-- Canonical -->
    <link rel="canonical" href="https://docs.blissos.org/installation/install-in-a-virtual-machine/advanced-qemu-config/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://docs.blissos.org/installation/install-in-a-virtual-machine/advanced-qemu-config/">
    <meta property="og:title" content="Advanced configuration for qemu">
    <meta property="og:description" content="Qemu is a very powerful tool that may be confusing for a lot of people.">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://docs.blissos.org/installation/install-in-a-virtual-machine/advanced-qemu-config/">
    <meta property="twitter:title" content="Advanced configuration for qemu">
    <meta property="twitter:description" content="Qemu is a very powerful tool that may be confusing for a lot of people.">

    <script data-cfasync="false">(function () { var el = document.documentElement, m = localStorage.getItem("doc_theme"), wm = window.matchMedia; if (m === "dark" || (!m && wm && wm("(prefers-color-scheme: dark)").matches)) { el.classList.add("dark") } else { el.classList.remove("dark") } })();</script>

    <link href="../../../resources/css/retype.css?v=3.5.0.766768982351" rel="stylesheet">

    <script data-cfasync="false" src="../../../resources/js/config.js?v=3.5.0.766768982351" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../../../resources/js/retype.js?v=3.5.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../../../resources/js/lunr.js?v=3.5.0.766768982351" data-turbo-eval="false" defer></script>
    <script id="prism-js" data-cfasync="false" src="../../../resources/js/prism.js?v=3.5.0.766768982351" defer></script>
</head>
<body>
    <div id="docs-app" class="relative text-base antialiased text-gray-700 bg-white font-body dark:bg-dark-850 dark:text-dark-300">
        <div class="absolute bottom-0 left-0 bg-gray-100 dark:bg-dark-800" style="top: 5rem; right: 50%"></div>
    
        <header id="docs-site-header" class="sticky top-0 z-30 flex w-full h-16 bg-white border-b border-gray-200 md:h-20 dark:bg-dark-850 dark:border-dark-650">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton docs-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="docs-sidebar-toggle"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="docs-site-logo" href="../../../" class="flex items-center leading-snug text-2xl">
                            <span class="w-10 mr-2 grow-0 shrink-0 overflow-hidden">
                                <img class="max-h-10 dark:hidden md:inline-block" src="../../../static/blissos.png">
                                <img class="max-h-10 hidden dark:inline-block" src="../../../static/blissos.png">
                            </span>
                            <span class="dark:text-white font-semibold line-clamp-1 md:line-clamp-2">BlissOS</span>
                        </a><span class="hidden px-2 py-1 ml-4 text-sm font-semibold leading-none text-root-logo-label-text bg-root-logo-label-bg rounded-sm md:inline-block">Docs</span>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block dark:border-dark-650"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="../../../">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M11.03 2.59a1.501 1.501 0 0 1 1.94 0l7.5 6.363a1.5 1.5 0 0 1 .53 1.144V19.5a1.5 1.5 0 0 1-1.5 1.5h-5.75a.75.75 0 0 1-.75-.75V14h-2v6.25a.75.75 0 0 1-.75.75H4.5A1.5 1.5 0 0 1 3 19.5v-9.403c0-.44.194-.859.53-1.144ZM12 3.734l-7.5 6.363V19.5h5v-6.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v6.25h5v-9.403Z"/>
                                        </g>
                                    </svg>
                                    <span>Home</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/BlissRoms-x86/support" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1ZM2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12Zm9.5 2a2 2 0 1 1-.001-3.999A2 2 0 0 1 12 14Z"/>
                                        </g>
                                    </svg>
                                    <span>Issues</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://twitter.com/blissos_org" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-.139 9.237c.209 4.617-3.234 9.765-9.33 9.765-1.854 0-3.579-.543-5.032-1.475 1.742.205 3.48-.278 4.86-1.359-1.437-.027-2.649-.976-3.066-2.28.515.098 1.021.069 1.482-.056-1.579-.317-2.668-1.739-2.633-3.26.442.246.949.394 1.486.411-1.461-.977-1.875-2.907-1.016-4.383 1.619 1.986 4.038 3.293 6.766 3.43-.479-2.053 1.08-4.03 3.199-4.03.943 0 1.797.398 2.395 1.037.748-.147 1.451-.42 2.086-.796-.246.767-.766 1.41-1.443 1.816.664-.08 1.297-.256 1.885-.517-.439.656-.996 1.234-1.639 1.697z"/>
                                        </g>
                                    </svg>
                                    <span>Twitter</span>
                                </a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-gray-400 transition-colors duration-200 ease-in bg-gray-200 border border-transparent rounded md:text-sm hover:bg-white hover:border-gray-300 focus:outline-none focus:bg-white focus:border-gray-500 dark:bg-dark-600 dark:border-dark-600 dark:placeholder-dark-400" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="docs-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
        <div class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-gray-100 border-gray-200 sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton dark:bg-dark-800 dark:border-dark-650">
            
                <!-- Render this div, if config.showSidebarFilter is `true` -->
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-white border border-gray-200 rounded shadow-none text-sm focus:outline-none focus:border-gray-600 dark:bg-dark-600 dark:border-dark-600" type="text" placeholder="Filter">
                </div>
            
                <div class="pl-6 mt-1 mb-4">
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                </div>
            
                <div class="shrink-0 mt-auto bg-transparent dark:border-dark-650">
                    <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                        <span class="text-xs whitespace-nowrap">Powered by</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                    </a>
                </div>
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-dark-650">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-dark-650">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="../../../">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M11.03 2.59a1.501 1.501 0 0 1 1.94 0l7.5 6.363a1.5 1.5 0 0 1 .53 1.144V19.5a1.5 1.5 0 0 1-1.5 1.5h-5.75a.75.75 0 0 1-.75-.75V14h-2v6.25a.75.75 0 0 1-.75.75H4.5A1.5 1.5 0 0 1 3 19.5v-9.403c0-.44.194-.859.53-1.144ZM12 3.734l-7.5 6.363V19.5h5v-6.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v6.25h5v-9.403Z"/>
                                                </g>
                                            </svg>
                                            <span>Home</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/BlissRoms-x86/support" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1ZM2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12Zm9.5 2a2 2 0 1 1-.001-3.999A2 2 0 0 1 12 14Z"/>
                                                </g>
                                            </svg>
                                            <span>Issues</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://twitter.com/blissos_org" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-.139 9.237c.209 4.617-3.234 9.765-9.33 9.765-1.854 0-3.579-.543-5.032-1.475 1.742.205 3.48-.278 4.86-1.359-1.437-.027-2.649-.976-3.066-2.28.515.098 1.021.069 1.482-.056-1.579-.317-2.668-1.739-2.633-3.26.442.246.949.394 1.486.411-1.461-.977-1.875-2.907-1.016-4.383 1.619 1.986 4.038 3.293 6.766 3.43-.479-2.053 1.08-4.03 3.199-4.03.943 0 1.797.398 2.395 1.037.748-.147 1.451-.42 2.086-.796-.246.767-.766 1.41-1.443 1.816.664-.08 1.297-.256 1.885-.517-.439.656-.996 1.234-1.639 1.697z"/>
                                                </g>
                                            </svg>
                                            <span>Twitter</span>
                                        </a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
            
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 dark:bg-dark-850">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div class="min-w-0 p-4 grow md:px-16">
                        <main class="relative pb-12 lg:pt-2">
                            <div class="docs-markdown" id="docs-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="docs-sidebar-right-toggle"></div>
                                <!-- Page content  -->
<doc-anchor-target id="advanced-configuration-for-qemu-cli" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#advanced-configuration-for-qemu-cli">#</doc-anchor-trigger>
        <span>Advanced configuration for qemu cli</span>
    </h1>
</doc-anchor-target>
<p>Qemu is a very powerful tool that may be confusing for a lot of people. However when using it we can get some very detailed and custom setups, this page will document some more advanced features that folk may wish to utilize with qemu. The majority of this page will assume running on linux. Many of these will not be compatible with windows. While this guide is oriented towards Android. Many of the same concepts apply to general VM usage.</p>
<p>Many of the concepts on this page will not apply to all users, If you have been linked This document is a document and this warning is still present. Any questions or corrections can be asked and posted on the Bliss OS telegram, Matrix, and Discord groups. Ping <code v-pre>@quackdoc</code> <code v-pre>@Quack Doc</code>.</p>
<p>This guide is for for qemu&#x27;s cli. while many concepts still apply, virt-manager/libvirt documentation is being worked on.</p>
<doc-anchor-target id="evdev">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#evdev">#</doc-anchor-trigger>
        <span>Evdev</span>
    </h2>
</doc-anchor-target>
<p>One of the more useful and easy to implement features of qemu is evdev passthrough. Doing this can enable low latency and a better by using hotkeys to globally toggle device passthrough.</p>
<p>There are two methods of doing this, we can use <code v-pre>virtio-input-host</code> and we can attach evdev to <code v-pre>virtio-mouse</code> and <code v-pre>virtio-keyboard</code>.Using <code v-pre>virtio-input-host</code> will give the guest exclusive access to the device, and will implicitly setup the proper device. This may cause bugs, and is likely not what all users would like, however this might be helpful for unique devices that don&#x27;t fall under traditional inputs, and won&#x27;t work with usb passthrough.</p>
<p><code v-pre>virtio-input-host</code> is fairly easy to setup and simply add. It does however come at the detriment that you cannot use a hotkey to bind it back to the host without closing the VM. It accepts both <code v-pre>eventx</code> device files, as well as works with <code v-pre>by-id</code> paths. However the strength of it comes from being able to use any evdev device. This includes gamepads, some multi-touch screens and more.</p>
<p>The below to add a multi-touch device through to the VM.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">-device virtio-input-host,id=touch0,evdev=/dev/input/eventX</code></pre>
</doc-codeblock></div>
<p>A minimal example of this would be</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash"> #!/bin/bash
 qemu-system-x86_64 \
 -enable-kvm \
 -M q35 -m 4096 -smp 4 -cpu host \
 -bios /usr/share/ovmf/x64/OVMF.fd \
 -drive file=disks/bliss.qcow2,if=virtio \
 -device virtio-vga-gl -display sdl,gl=on \
 -device virtio-input-host,id=touch0,evdev=/dev/input/eventx</code></pre>
</doc-codeblock></div>
<p>The more common option would be attaching evdev devices to <code v-pre>virtio-keyboard</code> and <code v-pre>virtio-mouse</code>. This will allow us to toggle back and forth between the guest VM and the host OS. We need to attach the below output to qemu corresponding device ids.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none"> -object input-linux,id=mouse1,evdev=/dev/input/by-id/MOUSE_NAME
 -object input-linux,id=kbd1,evdev=/dev/input/by-id/KEYBOARD_NAME,grab_all=on,repeat=on</code></pre>
</doc-codeblock></div>
<p>A functional example of this would be</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash"> #!/bin/bash
 qemu-system-x86_64 \
 -enable-kvm \
 -M q35 -m 4096 -smp 4 -cpu host \
 -bios /usr/share/ovmf/x64/OVMF.fd \
 -drive file=disks/bliss.qcow2,if=virtio \
 -device virtio-tablet,id-mouse1 \
 -device virtio-keyboard,id=kbd1 \
 -device virtio-vga-gl -display sdl,gl=on \
 -object input-linux,id=mouse1,evdev=/dev/input/by-id/MOUSE_NAME \
 -object input-linux,id=kbd1,evdev=/dev/input/by-id/KEYBOARD_NAME,grab_all=on,repeat=on</code></pre>
</doc-codeblock></div>
<p>By default you can use left and right <code v-pre>ctrl</code> together to change whether the device is used by the host or the VM.</p>
<doc-anchor-target id="flexible-bash-scripting">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#flexible-bash-scripting">#</doc-anchor-trigger>
        <span>Flexible bash scripting</span>
    </h2>
</doc-anchor-target>
<p>Some people who add and remove options from qemu often may find that the current script setups are more of a hassle to use. However we can set up scripts using arrays instead this can allow users to comment out arguments from the script without breaking script. This is very useful for prototyping as this allows us to more efficiently test and comment out various arguments. This does however pose some issues which will be explained under the <code v-pre>booting a physical install</code> section.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">#!/bin/bash

## cd image &quot;bliss.iso&quot;
array=(
-enable-kvm
-M q35
-m 6000
-smp 3
-cpu host
-bios /usr/share/ovmf/x64/OVMF.fd
-drive file=android.qcow2,if=virtio
#-cdrom ~/Downloads/bliss.iso
-device virtio-tablet
-device virtio-keyboard
-device qemu-xhci,id=xhci
-machine vmport=off
-device virtio-vga-gl
-display sdl,gl=on
-net nic,model=virtio-net-pci -net user,hostfwd=tcp::4444-:5555
)

qemu-system-x86_64 ${array[@]}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="vfio">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#vfio">#</doc-anchor-trigger>
        <span>VFIO</span>
    </h2>
</doc-anchor-target>
<p>You may wish to pass a physical PCIe through to the VM. This can be helpful for people looking to make a gaming setup using Bliss, or perhaps more unique setups. Qemu and Crosvm both allow doing this. With libvirt this is unbinding, and binding is handled mostly automatically. You still need to load the vfio module yourself (see below).</p>
<p>This article will assume you have prepared IOMMU for passthrough, there are many guides on how to find your IOMMU grouping. If you have a bad grouping it is typically possible to override them using ACS override. Be warned, this is a potential security risk and could be dangerous for host security. ACS will not be elaborated any further in this and it is totally an <code v-pre>At your own risk</code> solution.</p>
<p>First we need to prepare the device(s) we are going to passthrough, the command to achieve this is below. It requires root being done by root, not simply with root permissions. The easiest way to do this is to use <code v-pre>su -c</code>. but first we need the pcie function address and the pcie driver. To get this we can use <code v-pre>lspci | grep -i &lt;vendor&gt;</code> to find the function address. We can then use <code v-pre>lspci -vvnn -s xx:xx.x</code> to get the pci device driver too. It will be listed under <code v-pre>kernel modules: &lt;pci_device_driver&gt;</code>. After that we need to append the domain to it, for the majority of users it will be <code v-pre>0000:</code>. Below is an example command line.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">su -c 'echo 0000:&lt;function_address&gt; &gt; /sys/bus/pci/drivers/&lt;pci_device_driver&gt;/unbind' </code></pre>
</doc-codeblock></div>
<p>After we have unmounted the drive we need to bind to vfio. This is done in a similar manner with the command below, however we need to load the vfio module and use the vid:pid of the device. The VID and PID will be printed in <code v-pre>lspci -nn xx:xx.x</code> an example output would, in the case below where the vid and pid would be <code v-pre>8086 56a5</code> be;</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">0d:00.0 VGA compatible controller [0300]: Intel Corporation DG2 [Arc A380] [8086:56a5] (rev 05)</code></pre>
</doc-codeblock></div>
<p>Using the above output we would do the below command to bind the DG2 graphics card to VFIO.</p>
<p>If you have multiple GPUs with the same vendor and product IDs, you will need to use same GPU passthrough techniques. Arch wiki&#x27;s PCI_passthrough page provides a number of possible scripts one can use to make this possible.</p>
<p>This needs to be done for all the devices in the IOMMU group until all of them are bound to VFIO.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">sudo modprobe vfio
su -c 'echo 8086 56a5 &gt; /sys/bus/pci/drivers/vfio-pci/new_id&quot;' </code></pre>
</doc-codeblock></div>
<p>You can instead add this to module autoload using your init system, this can be done various ways such as mkinitcpio and systemd, an example of a systemd setup would be;</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">/etc/modules-load.d/vfio.conf
~~~~~~~~~~~~~~~~~~~~~~~~~
vfio-pci</code></pre>
</doc-codeblock></div>
<p>After the card is loaded into VFIO we can then load it into qemu using the below argument. The second device is because we need to passthrough any additional function devices separately, this include audio and on some gpus USB controllers.</p>
<p>All devices in the iommu group should too be bound to the VM.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">-device vfio-pci,host=&lt;function_address&gt;,multifunction=on,x-vga=on \
-device vfio-pci,host=&lt;function_address&gt;</code></pre>
</doc-codeblock></div>
<p>It may also be necessary to specify the <code v-pre>pcie-root-port</code> device.  Below is a small example of this</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">    -device pcie-root-port,id=pcie.1,bus=pcie.0,addr=1c.0,slot=1,chassis=1,multifunction=on \
    -device vfio-pci,host=&lt;function_address&gt;,bus=pcie.1,addr=00.0,x-vga=on,multifunction=on \
    -device vfio-pci,host=&lt;function_address&gt;,bus=pcie.1,addr=00.1</code></pre>
</doc-codeblock></div>
<p>It is a good idea to explicitly disable attaching any other displays to qemu by passing the arguments. This may or may not be needed.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">-nographic -vga none</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="booting-physical-media">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#booting-physical-media">#</doc-anchor-trigger>
        <span>Booting physical media</span>
    </h2>
</doc-anchor-target>
<p>Below is an example of booting a physical install where a second drive is mounted to <code v-pre>nvme</code> and bliss is installed in the folder called <code v-pre>android</code>. However there is a small issue, due to how arrays work under bash, this can complicate how variables and strings work, meaning that sometimes it is better to simply avoid using them in the array, thankfully that does not pose too much issues in the majority of cases.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">#!/bin/bash

install_location=/nvme/android

#common kernel arguments;
#root=/dev/ram0 console=ttyS0 HWC=drm_minigbm GRALLOC=minigbm_arcvm video=800x480 DATA=/dev/vdb quiet DEBUG=2
#'-drive index=0,if=virtio,id=system,file=${install_location}system.efs,format=raw,readonly=on'


args=(
    ##CPU
    '-smp 4'
    '-M q35'
    '-m 4096'
    '-cpu host'
    '-accel kvm'
    ##GPU
    '-device virtio-vga-gl,edid=on'
    '-display sdl,gl=on,show-cursor=true'
    ##devices
    '-usb'
    '-audiodev pa,id=snd0'
    '-device AC97,audiodev=snd0'
    '-device virtio-tablet'
    '-device virtio-keyboard'
    ##net
    '-net nic,model=virtio-net-pci -net user,hostfwd=tcp::4444-:5555'
    ##drives
    '-drive index=0,if=virtio,id=system,file=/nvme/android/system.efs,format=raw,readonly=on'
    '-drive index=0,if=virtio,id=system,file=/nvme/android/data.img,format=raw,readonly=on'
    '-initrd /nvme/android/initrd.img'
    '-kernel /nvme/android/kernel'
    ##misc
    '-monitor stdio'
    #`-serial stdio`
    #'-serial mon:stdio'
)

qemu-system-x86_64 ${args[@]} \
      -append &quot;root=/dev/ram0 console=ttyS0 HWC=drm_minigbm GRALLOC=minigbm_arcvm DATA=/dev/vdb&quot; </code></pre>
</doc-codeblock></div>
<doc-anchor-target id="usb-passthrough">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#usb-passthrough">#</doc-anchor-trigger>
        <span>USB passthrough</span>
    </h2>
</doc-anchor-target>
<p>In qemu, there are three main ways to achieve USB passthrough. <code v-pre>Spice</code>, <code v-pre>VFIO</code> and <code v-pre>usb-host</code>. When using <code v-pre>usb-host</code> we can passthrough either a <code v-pre>hub</code> device or a specific usb device. I have typically had poor experience using hub passthrough in the past so I would recommend preferring single device passthrough.</p>
<p>The most simple way to do this is typically the best, simply run <code v-pre>lsusb</code> and grab the <code v-pre>VID:PID</code> of the device you wish to passthrough, Then use <code v-pre>-device usb-host</code> to add it to the VM.</p>
<p>Instead of simply adding <code v-pre>-usb</code> we can add specific controllers instead, an example would be.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">    -device qemu-xhci \
    -device usb-host,vendorid=0xVID,productid=0xPID,id=$SOMETHINGHERE</code></pre>
</doc-codeblock></div>
<p>In some cases it might be more suitable to attach the device using it&#x27;s address;</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">    -usb \
    -device usb-host,hostbus=bus,hostaddr=addr</code></pre>
</doc-codeblock></div>
<p>In other cases you can use the below command to passthrough via hostbus and host port, which is useful for passing through usb hubs. Finding the appropriate hub or device can be done using <code v-pre>lsusb -t</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">    -usb \
    -device usb-host,hostbus=bus,hostport=port</code></pre>
</doc-codeblock></div>
<p>It is always a good idea to append an appropriate ID to the device, in case of a keyboard, simply do <code v-pre>id=keyboard</code> in the case of a thumbdrive, you can do <code v-pre>id=usb-drive</code>. This is largely preference.</p>
<p>For using Spice,</p>
<p>It will be explained in more depth below, however in the spice client you will need to enable usb-passthrough and select the appropriate device there.</p>
<p>For VFIO,</p>
<p>Simply pass the appropriate USB controller through to the VM using vfio above. Using <code v-pre>lsusb -t</code> to locate the controller and <code v-pre>lspci</code> can be useful for determining what devices to passthrough.</p>
<p>USB devices can be hotplugged using the Qemu Human Monitor explained below.</p>
<doc-anchor-target id="low-latency-pipewirejack-audio">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#low-latency-pipewirejack-audio">#</doc-anchor-trigger>
        <span>Low latency PipeWire/Jack audio</span>
    </h2>
</doc-anchor-target>
<p>Using qemu, we can instead of using pulse audio backend, use jack. This is very useful since we can use jack for higher quality and lower latency audio, as well as a highly configurable two way audio. This is great because Bliss and other Android x86 operating systems have a quite high base latency.</p>
<p>Using jack you can manage to cut a round trip from 240ms to 200ms. It&#x27;s important to remember that this is a <strong>Round Trip</strong> numbers, meaning the time it takes from audio to go from the host to the virtualized microphone, into Android, to the speakers, and back to the host. This is not the android -&gt; host latency, currently this is not something tested. however it could be anywhere from 1/3 of this to 2/3 of this. This will assume using PipeWire since it is the easiest and most convenient option.</p>
<p>Using <code v-pre>jack_lsp</code> to list ports we can connect to the ports I am interested are</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">speakers 

Family 17h (Models 00h-0fh) HD Audio Controller Analog Stereo:playback_FL
Family 17h (Models 00h-0fh) HD Audio Controller Analog Stereo:playback_FR

microphone 
Realtek Audio USB Analog Stereo:capture_FL
Realtek Audio USB Analog Stereo:capture_FR</code></pre>
</doc-codeblock></div>
<p>qemu uses regex to match, so here we want to choose a name that will match the devices we want, but not the extras</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">  -audiodev jack,id=jack0,out.connect-ports=Family,in.connect-ports=USB \
  -device ich9-intel-hda -device hda-duplex,audiodev=jack0</code></pre>
</doc-codeblock></div>
<p>If you remove the <code v-pre>out.connect-ports=Family,in.connect-ports=USB</code> part of the command line, it will create an output not connected to anything. In this case you could either manually connect ports using helvum or PipeWire direcly, or you could setup a WirePlumber profile to handle automatic connections. however this is far out of scope</p>
<p>We can also do a bit more tuning by setting <code v-pre>PIPEWIRE_LATENCY</code> When we do this, we can actually ignore the output qemu tells us when it starts as if we check pw-top we can see that it is indeed running when we check pw-top</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">export PIPEWIRE_LATENCY=128/48000</code></pre>
</doc-codeblock></div>
<p>However jack is not the only options we have, we also have Alsa output. this is about as direct as you can get automatically outputs to headphones and microphone properly, and is still controlled via PipeWire. however audio quality of it can be greatly dependant on the host PC. so while not recommended you can try it by using <code v-pre>-audiodev alsa,id=alsa0</code> instead of <code v-pre>-audiodev jack,id=jack0...</code></p>
<p>Testing <code v-pre>SDL</code> audio output is fine, but is higher latency than <code v-pre>Jack</code> so it would be typically not recommended.</p>
<p>As for the emulated audio devices, AC97 is the lowest latency, but may suffer in audio quality. There are multiple other audio devices however at this time I do not have a method for testing latency in them. The recommendation for low latency audio is <code v-pre>AC97</code> but for general use it is <code v-pre>-device ich9-intel-hda -device hda-duplex</code>.</p>
<p>This open the doors to advanced audio manipulation and high quality audio from Android. This can be useful for gaming as well as game recording since you could connect to a virtual device which could then be connected to both headphones and OBS.</p>
<p>This also opens the way for high fidelity audio though it is currently not recommended to go above 48000 hz on bliss at this time due to potential audio distorting.</p>
<doc-anchor-target id="egl-headless-for-remote-vms">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#egl-headless-for-remote-vms">#</doc-anchor-trigger>
        <span>EGL-headless for remote VMs</span>
    </h2>
</doc-anchor-target>
<p>Egl headless is useful for remote VMs. A remote VM being a virtual machine hosted on a separate machine that the user is connecting from. Much like <code v-pre>-display sdl,gl=on</code> or <code v-pre>-display spice,gl=on</code> this provides 3D acceleration. However unlike the two previous, this does not open a window on the server. This means you can use spice-app to connect to the VM over a network. It may also have lower preformance then the alternative.</p>
<p>You can use <code v-pre>rendernode=</code> to specify the GPU, this can be helpful to select a secondary GPU, or perhaps if you have many VMs running at the same time to spread the load across multiple GPUs.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">-display egl-headless,rendernode=/dev/dri/renderD128</code></pre>
</doc-codeblock></div>
<p>Note: you can not at the current time use multiple <code v-pre>-display</code> arguments, so you will need either spice server, or some other remote graphics solution. (IE. scrcpy)</p>
<doc-anchor-target id="spice">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#spice">#</doc-anchor-trigger>
        <span>Spice</span>
    </h2>
</doc-anchor-target>
<p>Spice is a method of interacting with VMs that can work both locally and over a network. It supports relatively advanced features such as usb redirection, video compression, and more. There are two ways to add spice to the VM, one for local machine, and one for remote machine. Below is an example of a local machine.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">    -device virtio-vga-gl -display spice-app,gl=on -device ac97 \
    -device virtio-serial -chardev spicevmc,id=vdagent,debug=0,name=vdagent \
    -device virtserialport,chardev=vdagent,name=com.redhat.spice.0 \</code></pre>
</doc-codeblock></div>
<p>And below this is an example of a remote machine. It&#x27;s important to remember to setup firewall and/or port forwarding to allow remote connections.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">    -spice port=3001,disable-ticketing -device ac97 -device virtio-vga-gl -display egl-headless \
    -device virtio-serial -chardev spicevmc,id=vdagent,debug=0,name=vdagent \
    -device virtserialport,chardev=vdagent,name=com.redhat.spice.0 \</code></pre>
</doc-codeblock></div>
<p>To setup usb redirection you can copy the below block into your config. For each device you want to be able to redirect, you need to add a <code v-pre>chardev</code> device and a <code v-pre>usb-redir</code> slot. These will let you dynamically change what devices you want to passthrough.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">#redirect up to 3 devices
    -chardev spicevmc,name=usbredir,id=usbredirchardev1 \
    -device usb-redir,chardev=usbredirchardev1,id=usbredirdev1 \
    -chardev spicevmc,name=usbredir,id=usbredirchardev2 \
    -device usb-redir,chardev=usbredirchardev2,id=usbredirdev2 \
    -chardev spicevmc,name=usbredir,id=usbredirchardev3 \
    -device usb-redir,chardev=usbredirchardev3,id=usbredirdev3</code></pre>
</doc-codeblock></div>
<p><a href="https://www.spice-space.org/spice-user-manual.html">https://www.spice-space.org/spice-user-manual.html</a></p>
<doc-anchor-target id="human-monitor">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#human-monitor">#</doc-anchor-trigger>
        <span>Human Monitor</span>
    </h2>
</doc-anchor-target>
<p>Instead of connecting tty to the terminal, we can also connect Qemu Human Monitor to the terminal. This is an interface that allows us to send commands to a running VM in order to interact with it. We can send shutdown and reset signals, add and remove usb and storage devices. As well as more advanced features like resize disks, dump the framebuffer (a sort of over glorified screenshot) and create VM snapshots. It is a very powerful tool and only some of the more common uses will be outlined here.</p>
<p>First thing is to add it to the VM. While with bliss it might be common to use <code v-pre>-serial stdio</code>, that will conflict with using qemu human monitor, what we instead want to use is <code v-pre>-monitor stdio</code>. If you need both, we can use <code v-pre>-serial mon:stdio</code> which will multiplex the serial connection and the qemu human monitor. You can swap between the two using <code v-pre>CTRL + a</code> then press <code v-pre>c</code>. That will swap between the serial and the human monitor.</p>
<p>When using spice, the human monitor will already be attached to it, so do not add commands to attach human monitor to qemu itself.</p>
<p>The other option you have is to connect either the serial connection or the monitor connection to a socket, then interfacing with it over said socket. However most people will likely not use this route. It is therefore recommended to simply use;</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">-serial mon:stdio</code></pre>
</doc-codeblock></div>
<p>However a short list of examples alternatives are below, there are more options.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">-monitor tcp:127.0.0.1:55555,server,nowait #tcp session
-monitor telnet:127.0.0.1:55555,server,nowait #telnet session
-monitor unix:qemu-monitor-socket,server,nowait #unix socket</code></pre>
</doc-codeblock></div>
<p>Now that we have the human monitor attached to the VM, we can get to some of the commands we can do with it. Below will be some commands with a brief writeup, to learn more about how to use the command read the link below;</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">system_reset #reboot the system
system_powerdown #powerdown the system
sendkey # sendkey ctrl-alt-f1 #send specific keys to the VM

quit # quit the VM
stop # pause the VM # may cause bugs on resume
cont # continue the VM
system_wakeup # wake VM

device_add #usb-host,hostbus=2,hostport=1.2.2,id=idofyourdevice # Add device
device_del #&lt;idofyourdevice&gt; #delete device
drive_add # add pci drive 
netdev_add # add nic
change #ide1-cd0 /path/to/some.iso #change device config

info #subcommand (snapshot to view snapshots) #print info about device 
savevm #creates a snapshot live, while the VM is still running
loadvm #loads a snapshot while the VM is still running

mouse_move #move the mouse
screendump #screenshot.ppm # dump screen into ppm image</code></pre>
</doc-codeblock></div>
<p><a href="https://qemu-project.gitlab.io/qemu/system/monitor.html">https://qemu-project.gitlab.io/qemu/system/monitor.html</a></p>
<doc-anchor-target id="disk-optimization">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#disk-optimization">#</doc-anchor-trigger>
        <span>Disk Optimization</span>
    </h2>
</doc-anchor-target>
<p>There is a LOT we can do for disk optimization! This section will be as condensed as possible while still giving you a good idea at what these features are doing. Because of this do not expect this section to be as clear as the other sections.Because there is a lot we need to cover here.</p>
<p>NOTE: If you want to run many VMs off of a single drive, or an array, your considerations may be very different and some of these will not apply for you! This section is written based on the assumption that one, or maybe a couple VMs are being run on the computer.</p>
<doc-anchor-target id="qcow2-vs-raw-image">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#qcow2-vs-raw-image">#</doc-anchor-trigger>
        <span>Qcow2 vs raw image</span>
    </h3>
</doc-anchor-target>
<p>When it comes to whether or not you should use qcow2 vs raw image, this really comes down to what you as a user want out of the images. First talking about performance. Raw vs Qcow2, under normal circumstances, should typically have similar performance. However, Qcow2 can certainly be slow under the right (or perhaps better put wrong) circumstances.</p>
<p>If you want a simple answer to the question &quot;Which format will give me the best performance?&#x27;&#x27; The answer is a raw image. If you don&#x27;t want any advanced features or configuration like compression or snapshots, you can skip the rest of the disk section.</p>
<doc-anchor-target id="preallocation">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#preallocation">#</doc-anchor-trigger>
        <span>Preallocation</span>
    </h3>
</doc-anchor-target>
<p>Preallocation is put simply, how the VM decides to assign storage blocks when no data is actually inside of them. with <code v-pre>preallocation=none</code> no data is pre assigned. this means that the disk image is very small, and will grow as more data gets written to it. when you choose <code v-pre>metadata</code> it pre allocates space for metadata, this means an empty VM disk will take up more space then one with <code v-pre>none</code>.</p>
<p>In most cases, the user will probably just want metadata. as it gives the best performance to space and features. falloc and full preallocation will cause the VM to use up more space. however in accordance with the chart below, performance goes up when you go down the chain. But you do start to lose some features, as <code v-pre>full</code> will cause snapshots to no longer work.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">none 
metadata
falloc
full</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="compression">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#compression">#</doc-anchor-trigger>
        <span>Compression</span>
    </h3>
</doc-anchor-target>
<p>Using compression to save space on your image can be a very valuable tool. while there are multiple ways to do this, but the focus of this will be on using qemu-img&#x27;s qcow2 compression, you can simply run <code v-pre>qemu-img create -f qcow2 -o compression_type=zstd disk.qcow2 10G</code> and this will create a zstd compressed disk image for you to use.</p>
<doc-anchor-target id="cache-modes">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cache-modes">#</doc-anchor-trigger>
        <span>Cache Modes</span>
    </h3>
</doc-anchor-target>
<p>Qemu supports a variety of disk write <code v-pre>cache</code> modes. These cache modes can be changed to tweak I/O speed below are the ones qemu support, See the link below for an explanation on these. Using none will essentially be the best performance option.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">writethrough
writeback
none
directsync
unsafe</code></pre>
</doc-codeblock></div>
<p><a href="https://documentation.suse.com/sles/12-SP4/html/SLES-all/cha-cachemodes.html">https://documentation.suse.com/sles/12-SP4/html/SLES-all/cha-cachemodes.html</a></p>
<doc-anchor-target id="custom-cache-size">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#custom-cache-size">#</doc-anchor-trigger>
        <span>Custom cache size</span>
    </h3>
</doc-anchor-target>
<p>With qemu we can set both <code v-pre>cache</code> size and <code v-pre>l2 cache</code> size</p>
<p><code v-pre>...disk.qcow2,cache-size=16M</code></p>
<p><code v-pre>...disk.qcow2,l2-cache-size=4M</code> where <code v-pre>1M</code> is good for <code v-pre>8Gb</code> of random R/W. <code v-pre>Areasize / (clustersize / 8)</code> where default cluster size is <code v-pre>64kb</code>. and area size is the total ammount of space you want cache to cover. <code v-pre>1/8th</code> of <code v-pre>64kb</code> is a nice <code v-pre>8kb</code>.</p>
<p>In this example we can say we want <code v-pre>16gb</code> of r/w headroom, we do <code v-pre>16gb / 8kb</code>. An easier way to calculate this by hand would be scientific notation. This would be <code v-pre>32x10^9 / 8x10^3 = 4x10^6 = 4mb</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">1KB = 10^3
1MB = 10^6
1GB = 10^9
1PB = 10^12
etc</code></pre>
</doc-codeblock></div>
<p>Try increasing cluster size instead <code v-pre>qemu-img create -f qcow2 -o cluster_size=2M</code>.</p>
<p><em>Try mixing <code v-pre>2m cluster</code> and <code v-pre>metadata</code> for a good blend of preformance!</em></p>
<doc-anchor-target id="backups-and-snapshots">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#backups-and-snapshots">#</doc-anchor-trigger>
        <span>Backups and snapshots</span>
    </h3>
</doc-anchor-target>
<p>Utilizing snapshots is a key feature in doing development, as well as making sure that any downtime is minimal. This is particularly useful for preventing a corruption inside of the machine from causing a re-install.</p>
<p>There are two main ways of doing this, you can create a full backup of the drive. This is as simple as doing rclone. This does however waste a lot of space. What we can do instead is use qemu-snapshot.</p>
<p>Qemu-snapshot redirects the writes to a new image, so that you can save space. say you have <code v-pre>disk.qcow2</code> you can run the command <code v-pre>qemu-img create -f qcow2 -b disk.qcow2 disk-snap1.qcow2</code> and that will create a new image. Now you modify qemu to use <code v-pre>disk-snap1.qcow2</code> it will read from <code v-pre>disk.qcow2</code> but will never write to it. All modifications made are made in <code v-pre>disk-snap1.qcow2</code>. and to revert the snapshot, you can simply delete the <code v-pre>disk-snap1.qcow2</code>.</p>
<p>Another use of this is to do <code v-pre>qemu-img create -f qcow2 -b base.qcow2 vm1.qcow2</code> &amp;&amp; <code v-pre>qemu-img create -f qcow2 -b base.qcow2 vm2.qcow2</code>. by making two separate snapshots, we can now run multiple VMs each with their own unique writable disk, that is based on the <code v-pre>base.qcow2</code>. this is great for running multiple VMs without needing to waste space and setup time. <strong>REMEMBER</strong> writing to the base disk will corrupt the snapshots. It&#x27;s a wise idea to change the permissions of the base disk to read only, this prevents user error. Even professionals with many hours can slip up and accidentally make an error. Remember to practice safe VM handling.</p>
<p>The above paragraph is about creating external snapshots which is great for when the VM is off, and should be done when you wish to create a new VM. However qemu also supports internal snapshots and live snapshots. The snapshots work internally in the single qcow2 (or qed) image. It may not be as flexible, however it is bother faster, and for many people more convenient and nice to use internal snapshots.</p>
<p>Using the human monitor above it is shown the commands <code v-pre>savevm</code> <code v-pre>loadvm</code> <code v-pre>info snapshots</code> these can be used to save, load and view the current snapshots available. Live snapshots save the entire state of the <code v-pre>cpu</code>, <code v-pre>devices</code>, <code v-pre>Ram</code>, as well as the entire disk contents, so the live snapshots can be a good amount larger. It is very akin to using an emulator &quot;save state&quot;.</p>
<p>Removable devices can sometimes cause issues, so it&#x27;s preferred to disconnect any before taking a snapshot and before loading one. However as long as all the devices are there when the snapshot is made and loaded it will be fine.</p>
<doc-anchor-target id="full-device-passthrough">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#full-device-passthrough">#</doc-anchor-trigger>
        <span>full device passthrough</span>
    </h3>
</doc-anchor-target>
<p>For passing storage devices to qemu there are multiple ways of doing so. To pass a sata controller, the most typical way of doing this will be via pci passthrough. You can accomplish this with the <code v-pre>vfio</code> instructions listed previously.</p>
<p>As for <code v-pre>Nvme</code> devices, you can actually do something similar, you can use vfio, however a better way of doing it would be to actually use qemu&#x27;s built in functionality for this listed below</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">qemu-system-x86_64 -drive file=nvme://HOST:BUS:SLOT.FUNC/NAMESPACE</code></pre>
</doc-codeblock></div>
<p>You can also passthrough <code v-pre>raw block devices</code> or better known as partition passthrough. you can pass it through a lot like you could with a standard file, an example is given below</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">    -drive file=/dev/sdb2,if=none,id=drive-virtio-disk0,format=raw \
    -device virtio-blk-pci,scsi=off,drive=drive-virtio-disk0,id=virtio-disk0</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="iothread">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#iothread">#</doc-anchor-trigger>
        <span>IoThread</span>
    </h3>
</doc-anchor-target>
<p>IO threads can help both raw and qcow2 when using virtio drives</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">-object iothread,id=iothread0
-device virtio-blk-pci,iothread=iothread0,id=...
-device virtio-scsi-pci,iothread=iothread0,id=...</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="erofs-to-sfs-and-the-other-way-around">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#erofs-to-sfs-and-the-other-way-around">#</doc-anchor-trigger>
        <span>EroFS to SFS and the other way around.</span>
    </h3>
</doc-anchor-target>
<p>Bliss is currently shipping with <code v-pre>SquashFS</code> or <code v-pre>EroFS</code>. <code v-pre>EroFS</code> has the best raw read speed of the supported read only filesystems. however it has a significant compromise in being the compression. <code v-pre>EroFS</code> only supports <code v-pre>LZMA</code> and <code v-pre>LZ4</code> compression. <code v-pre>LZMA</code> is quite slow, and LZ4 doesn&#x27;t offer great compression ratios.</p>
<p>So there are two reasons why you would want to recompress <code v-pre>system.img</code> using <code v-pre>SquashFS</code> or <code v-pre>EroFS</code>. The first one being wanting to simply shrink the the size of system.img.</p>
<p>if you have an <code v-pre>eroFS</code> image and want to compress it further, you may want to convert it to an <code v-pre>SquashFS</code> image. Likewise, if you have an <code v-pre>SFS</code> image, you might be better suited to convert it to <code v-pre>EroFS</code> if you want better performance if you are willing to sacrifice a bit of storage space.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">sudo modprobe erofs # Many distros will ship EroFS but it won't be enabled by default
sudo mount -o loop system.efs /mnt 
mksquashfs /mnt system.sfs -comp zstd # you can choose from a couple different formats but ZSTD is the main benefit here
sudo umount /mnt
rm system.efs</code></pre>
</doc-codeblock></div>
<p>If you wanted to keep using <code v-pre>EroFS</code> but use the slower but best in class compression LZMA, you could use the below sample.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">sudo modprobe erofs
mv system.efs system-old.efs
sudo mount -o loop system-old.efs
mkfs.erofs -c xz system.efs /mnt
sudo umount /mnt
rm system-old.efs</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="qa-about-qemus-drives">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#qa-about-qemus-drives">#</doc-anchor-trigger>
        <span>Q&amp;A about qemu&#x27;s drives</span>
    </h3>
</doc-anchor-target>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Q: `virtio-blk` vs `virtio-scsi`
A: `Virtio-blk` is usually faster across the board, however is limited in the amount of drives, probably not an issue for most</code></pre>
</doc-codeblock></div>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Q: what is the best `Cache` mode to use?
A: you typically want `cache=none`</code></pre>
</doc-codeblock></div>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Q: My VM has terrible write speeds, and it is even effecting my host
A: check if you are using a COW fs. if so disable COW on btrfs and other COW systems for the VM</code></pre>
</doc-codeblock></div>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Q: `lazy_refcounts` Can cause corruption! but is it worth it?
A: Typically yes. performance can increase by a good amount at the trade off of accidental power off. But disable it if you change the `cache` mode to `none`.</code></pre>
</doc-codeblock></div>
<p><a href="https://events19.lfasiallc.com/wp-content/uploads/2017/11/Storage-Performance-Tuning-for-FAST-Virtual-Machines_Fam-Zheng.pdf">https://events19.lfasiallc.com/wp-content/uploads/2017/11/Storage-Performance-Tuning-for-FAST-Virtual-Machines_Fam-Zheng.pdf</a></p>
<doc-anchor-target id="finishing-notes">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#finishing-notes">#</doc-anchor-trigger>
        <span>Finishing Notes</span>
    </h2>
</doc-anchor-target>
<p>Handling multiple VMs efficiently can be a complicated topic, and is largely out of scope for this guide. This bit is just a few tips to make running more than a couple VMs a better experience. This would be a stopgap between a more professional solution such as <code v-pre>proxmox</code> or a <code v-pre>libvirt</code>. This is just a rough guideline, and may not apply across the board or when you scale up.</p>
<p>When installing <code v-pre>Bliss</code>, It might be a good idea to break up the Disks, you only need one <code v-pre>system</code> disks for the VMs if it&#x27;s read only. This can save many gigabytes of data storage, and increase storage performance across the storage of any potentially affected drives.</p>
<p>Another good idea is to consider what VMs need persistent memory and which ones don&#x27;t. If you are running many VMs at once, whether it be for a cloud solution or a more tailored setup, you may find that you don&#x27;t want many, or even any of the VMs to retain any modifications to them.</p>
<p>It is <strong>highly</strong> recommend reading the free <code v-pre>redhat</code> docs on setting up and tuning VMs if you need more than what this guide offers. It will be a lot of reading. It will however be more valuable than most resources you can freely find on the internet. It should be the first stop for anyone wanting to actually learn more and implement these kinds of setups for yourself.</p>
<p>The next freely accessible resource is the <code v-pre>oVirt</code> forums, documentation, and most importantly Mailing list. <code v-pre>oVirt</code> is an enterprise grade solution built upon libvirt so many of the solutions and concepts will directly apply when using libvirt, and can be used to gain a further understanding of VM infrastructure in general.</p>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_tuning_and_optimization_guide/index">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_tuning_and_optimization_guide/index</a></p>

                                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                            </div>
                            <footer class="clear-both">
                                <div class="flex flex-wrap items-center justify-between mt-14">
                                    <a class="my-2.5 inline-flex items-center text-sm whitespace-nowrap text-blue-500 dark:text-blue-400 hover:text-blue-700 hover:underline" href="https://github.com/BlissRoms-x86/Documentation/blob/main/Installation/install-in-a-virtual-machine/advanced-qemu-config.md" target="_blank" rel="noopener">
                                        <svg class="mr-1.5" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M20 12c-.55 0-1 .45-1 1v7c0 .55-.45 1-1 1H4c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h7c.55 0 1-.45 1-1s-.45-1-1-1H4C2.35 3 1 4.35 1 6v14c0 1.65 1.35 3 3 3h14c1.65 0 3-1.35 3-3v-7c0-.55-.45-1-1-1z" /><path d="M22.21 1.79c-1.18-1.18-3.24-1.18-4.41 0l-9.5 9.5c-.13.13-.22.29-.26.46l-1 4c-.08.34.01.7.26.95.18.2.44.3.7.3.08 0 .16-.01.24-.03l4-1c.18-.04.34-.13.46-.26l9.5-9.5c1.22-1.22 1.22-3.2.01-4.42zm-1.42 3l-9.3 9.3-2.11.53.53-2.11 9.3-9.3c.42-.42 1.16-.42 1.59 0 .43.43.43 1.15-.01 1.58z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        <span>Edit on GitHub</span>
                                    </a>
                                </div>
                            
                                <nav class="flex mt-14">
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../../../installation/install-in-a-virtual-machine/install-in-virtualbox/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                            <span>
                                                <span class="block text-xs font-normal text-gray-400 dark:text-dark-400">Previous</span>
                                                <span class="block mt-1">[deprecated]Bliss OS: How to install Bliss OS on Virtual​Box</span>
                                            </span>
                                        </a>
                                    </div>
                            
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../../../installation/install-in-a-virtual-machine/install-in-qemu/">
                                            <span>
                                                <span class="block text-xs font-normal text-right text-gray-400 dark:text-dark-400">Next</span>
                                                <span class="block mt-1">Bliss OS: How to install Bliss OS on Qemu</span>
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        </a>
                                    </div>
                                </nav>
                            </footer>
                        </main>
                
                        <div class="border-t dark:border-dark-650 pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between">
                                <div>
                                    <ul class="flex flex-wrap items-center text-sm">
                                        <li>
                                            <a class="block mr-4 py-2 text-sm whitespace-nowrap transition-colors duration-200 ease-linear text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200 md:mb-0" href="https://blisslabs.org">A BlissLabs Project</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="docs-copyright py-2 text-gray-500 dark:text-dark-350 text-sm leading-relaxed"><p>© Copyright 2013-2024 – <a href="https://blisslabs.org">BlissLabs</a> – All rights reserved</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-white border-gray-200 lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton dark:bg-dark-850 dark:border-dark-650">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="docs-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "Advanced configuration for qemu", level: 3, icon: "file", hasPrism: true, hasMermaid: false, hasMath: false, tocDepth: 23 }</script>
</body>
</html>
